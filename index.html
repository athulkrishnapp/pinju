<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Promise Vault ðŸ”’</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Dancing+Script:wght@700&family=Poppins:wght@300;400;600&display=swap');

        :root {
            --primary: #ff4b6a;
            --neon: #00f3ff;
            --glass-bg: rgba(20, 20, 25, 0.85);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            background: radial-gradient(circle at center, #1a0b1a 0%, #000000 100%);
            font-family: 'Poppins', sans-serif;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: none;
        }

        /* --- BACKGROUND --- */
        #bg-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .bg-particle {
            position: absolute;
            background: var(--primary);
            border-radius: 50%;
            opacity: 0.4;
            animation: float 8s infinite linear;
        }

        /* --- UI LAYERS --- */
        .screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        /* --- 1. SETUP SCREEN --- */
        #setup-screen {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 40px 30px;
            border-radius: 25px;
            text-align: center;
            width: 85%;
            max-width: 380px;
            border: 1px solid rgba(255, 75, 106, 0.3);
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            animation: hudEntrance 0.8s ease-out;
        }

        .setup-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 0 0 10px 0;
            text-shadow: 0 0 10px rgba(255, 75, 106, 0.5);
        }

        input {
            width: 100%;
            padding: 15px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            box-sizing: border-box;
            outline: none;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #ff4b6a, #ff7b93);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            font-weight: 600;
            margin-top: 15px;
            box-shadow: 0 5px 20px rgba(255, 75, 106, 0.3);
            font-family: 'Orbitron', sans-serif;
        }

        #share-area {
            display: none;
            margin-top: 20px;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            border: 1px dashed rgba(255,255,255,0.2);
        }
        
        #link-text {
            word-break: break-all;
            font-size: 0.8rem;
            margin-bottom: 10px;
            color: var(--neon);
            font-family: monospace;
        }

        /* --- 2. SCANNER SCREEN --- */
        #scanner-screen { display: none; }

        .scan-title {
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 2px;
            margin-bottom: 40px;
            font-size: 1.4rem;
            text-shadow: 0 0 10px var(--neon);
            color: var(--neon);
        }

        .fingerprint-zone {
            width: 120px;
            height: 150px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 60px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: rgba(255,255,255,0.05);
            -webkit-tap-highlight-color: transparent;
        }

        .fingerprint-zone.scanning {
            border-color: var(--primary);
            box-shadow: 0 0 30px var(--primary);
        }

        .fingerprint-icon { font-size: 5rem; opacity: 0.5; user-select: none; }

        .scan-laser {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 4px;
            background: var(--primary);
            box-shadow: 0 0 15px var(--primary);
            opacity: 0;
        }

        .scanning .scan-laser { opacity: 1; animation: scanDown 1.5s linear infinite; }

        .status-text { margin-top: 25px; font-size: 1rem; color: #aaa; }

        /* --- 3. VAULT SCREEN --- */
        #vault-screen { display: none; }

        .card-container {
            width: 85%;
            max-width: 350px;
            min-height: 400px;
            background: rgba(20, 20, 30, 0.6);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 75, 106, 0.2);
            border-radius: 20px;
            padding: 30px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .promise-content {
            font-family: 'Dancing Script', cursive;
            font-size: 2.2rem;
            line-height: 1.4;
            color: #fff;
            margin-bottom: 30px;
        }

        .nav-btn {
            background: transparent;
            border: 2px solid var(--primary);
            color: white;
            padding: 12px 35px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
        }

        /* --- 4. FINAL SCREEN (Redesigned) --- */
        #final-screen { display: none; }

        .certificate-container {
            background: rgba(255, 255, 255, 0.05);
            padding: 40px 20px;
            border-radius: 20px;
            border: 1px solid rgba(255, 75, 106, 0.3);
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            max-width: 85%;
            width: 320px;
            text-align: center;
            position: relative;
        }

        .seal {
            width: 100px;
            height: 100px;
            border: 3px solid #ff4b6a;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Dancing Script', cursive;
            font-size: 1.5rem;
            color: #ff4b6a;
            transform: rotate(-15deg);
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%) rotate(-10deg);
            background: #1a0b1a;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .final-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            color: var(--primary);
            text-shadow: 0 0 10px rgba(255, 75, 106, 0.6);
            margin-top: 40px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .contract-text {
            font-family: 'Poppins', sans-serif;
            font-size: 0.8rem;
            color: #ccc;
            margin: 15px 0 5px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
        }

        .names-highlight {
            font-family: 'Dancing Script', cursive;
            font-size: 3rem;
            color: var(--neon);
            text-shadow: 0 0 15px var(--neon);
            margin: 5px 0 25px 0;
            line-height: 1.1;
        }

        /* Music Button */
        #music-toggle {
            position: absolute;
            top: 20px; right: 20px;
            font-size: 1.5rem;
            background: none; border: none;
            cursor: pointer; z-index: 100;
            filter: drop-shadow(0 0 5px white);
        }

        /* Animations */
        @keyframes float { 0% { transform: translateY(0); } 100% { transform: translateY(-120vh); } }
        @keyframes scanDown { 0% { top: 0; } 50% { top: 100%; opacity: 1; } 51% { opacity: 0; } 100% { top: 0; opacity: 0; } }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes hudEntrance { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    </style>
</head>
<body>

    <audio id="bg-music" loop preload="auto">
        <source src="song.mp3" type="audio/mpeg">
    </audio>

    <button id="music-toggle" onclick="toggleAudio()">ðŸ”‡</button>

    <div id="bg-container"></div>

    <div id="setup-screen" class="screen" style="z-index: 100;">
        <h2 class="setup-title">Promise Vault</h2>
        <p style="color:#aaa; font-size:0.9rem; margin-bottom:20px;">Initialize Digital Contract</p>
        
        <input type="text" id="s-input" placeholder="Your Name">
        <input type="text" id="r-input" placeholder="Partner's Name">
        
        <button class="btn" onclick="generateLink()">Create Link</button>
        <button class="btn" style="background:transparent; border:1px solid rgba(255,255,255,0.2); box-shadow:none; font-size:0.8rem; margin-top:10px; padding:10px;" onclick="startPreview()">Test / Preview</button>
        
        <div id="share-area">
            <div id="link-text"></div>
            <button class="btn" style="padding:10px; font-size:0.8rem; margin-top:5px; background: #333;" onclick="copyLink()">ðŸ“‹ Copy Link</button>
        </div>
    </div>

    <div id="scanner-screen" class="screen">
        <div class="scan-title">IDENTITY CHECK</div>
        <div class="fingerprint-zone" id="fp-zone" onmousedown="startScan()" ontouchstart="startScan(event)" onmouseup="stopScan()" ontouchend="stopScan()">
            <div class="fingerprint-icon">ðŸ”’</div>
            <div class="scan-laser"></div>
        </div>
        <div class="status-text" id="status-msg">Hold Finger to Unlock</div>
    </div>

    <div id="vault-screen" class="screen">
        <div class="card-container" id="card-box"></div>
    </div>

    <div id="final-screen" class="screen">
        <div class="certificate-container">
            <div class="seal">Signed</div>
            <h1 class="final-title">Promise Sealed</h1>
            
            <p class="contract-text">This digital soul contract certifies that</p>
            <div class="names-highlight" id="final-sender">Sender</div>
            
            <p class="contract-text">is bound by eternal love to</p>
            <div class="names-highlight" id="final-receiver">Receiver</div>
        </div>
    </div>

    <script>
        /* PARTICLES */
        function initParticles() {
            const bg = document.getElementById('bg-container');
            for(let i=0; i<30; i++) {
                const p = document.createElement('div');
                p.classList.add('bg-particle');
                p.style.left = Math.random() * 100 + 'vw';
                p.style.top = Math.random() * 100 + 'vh';
                const size = Math.random() * 5 + 2;
                p.style.width = size + 'px';
                p.style.height = size + 'px';
                p.style.animationDuration = Math.random() * 5 + 5 + 's';
                p.style.animationDelay = Math.random() * 5 + 's';
                bg.appendChild(p);
            }
        }
        initParticles();

        /* STATE */
        let senderName = "Sender";
        let receiverName = "Receiver";
        let scanInterval;
        let progress = 0;
        let cardIndex = 0;
        let isMusicPlaying = false;

        const promises = [
            "I promise to support your dreams, no matter how big they are.",
            "I promise to be your peace when the world gets too loud.",
            "I promise to always listen, understand, and never judge.",
            "I promise to love you a little more every single day.",
            "I promise to stay by your side, forever and always."
        ];

        /* SETUP */
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const s = params.get('from');
            const r = params.get('to');
            if(s && r) {
                senderName = decodeURIComponent(s);
                receiverName = decodeURIComponent(r);
                document.getElementById('setup-screen').style.display = 'none';
                document.getElementById('scanner-screen').style.display = 'flex';
            }
        };

        function generateLink() {
            const s = document.getElementById('s-input').value.trim();
            const r = document.getElementById('r-input').value.trim();
            if(!s || !r) { alert("Please enter both names."); return; }
            const url = `${window.location.href.split('?')[0]}?from=${encodeURIComponent(s)}&to=${encodeURIComponent(r)}`;
            document.getElementById('share-area').style.display = 'block';
            document.getElementById('link-text').innerText = url;
        }

        function copyLink() {
            const txt = document.getElementById('link-text').innerText;
            navigator.clipboard.writeText(txt).then(() => alert("Copied! Send it to your partner."));
        }

        function startPreview() {
            senderName = document.getElementById('s-input').value.trim() || "Kannan";
            receiverName = document.getElementById('r-input').value.trim() || "Appu";
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('scanner-screen').style.display = 'flex';
        }

        /* SCANNER */
        const fpZone = document.getElementById('fp-zone');
        const statusMsg = document.getElementById('status-msg');
        const music = document.getElementById('bg-music');

        function startScan(e) {
            if(e) e.preventDefault();
            if(!isMusicPlaying) {
                music.play().then(() => {
                    isMusicPlaying = true;
                    document.getElementById('music-toggle').innerText = "ðŸ”Š";
                }).catch(err => {});
            }
            fpZone.classList.add('scanning');
            statusMsg.innerText = "Scanning Biometrics...";
            statusMsg.style.color = "#ff4b6a";
            progress = 0;
            scanInterval = setInterval(() => {
                progress += 5;
                if(progress >= 100) { clearInterval(scanInterval); scanSuccess(); }
            }, 100);
        }

        function stopScan() {
            clearInterval(scanInterval);
            fpZone.classList.remove('scanning');
            if(progress < 100) {
                statusMsg.innerText = "Scan Interrupted. Hold Longer.";
                statusMsg.style.color = "white";
            }
        }

        function scanSuccess() {
            statusMsg.innerText = `Identity Verified: ${receiverName}`;
            statusMsg.style.color = "#00f3ff";
            statusMsg.style.textShadow = "0 0 10px #00f3ff";
            fpZone.onmousedown = null; fpZone.ontouchstart = null;
            setTimeout(() => {
                document.getElementById('scanner-screen').style.display = 'none';
                showVault();
            }, 1500);
        }

        /* VAULT */
        function showVault() {
            document.getElementById('vault-screen').style.display = 'flex';
            renderCard();
        }

        function renderCard() {
            const container = document.getElementById('card-box');
            container.style.animation = 'none';
            container.offsetHeight; 
            container.style.animation = 'popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275)';

            if(cardIndex < promises.length) {
                container.innerHTML = `
                    <div style="font-family:'Orbitron'; color:var(--neon); margin-bottom:20px;">PROMISE 0${cardIndex + 1}</div>
                    <div class="promise-content">"${promises[cardIndex]}"</div>
                    <button class="nav-btn" onclick="nextCard()">Next Promise</button>
                `;
            } else {
                container.innerHTML = `
                    <div style="font-family:'Orbitron'; color:var(--neon); margin-bottom:20px;">FINAL AUTHORIZATION</div>
                    <div class="promise-content">Do you accept these promises for eternity?</div>
                    <button class="nav-btn" style="background:#ff4b6a; border-color:#ff4b6a;" onclick="finishContract()">I Accept</button>
                `;
            }
        }

        window.nextCard = function() { cardIndex++; renderCard(); };

        window.finishContract = function() {
            document.getElementById('vault-screen').style.display = 'none';
            const finalScreen = document.getElementById('final-screen');
            finalScreen.style.display = 'flex';
            finalScreen.style.flexDirection = 'column';
            finalScreen.style.alignItems = 'center';
            finalScreen.style.justifyContent = 'center';
            
            document.getElementById('final-sender').innerText = senderName;
            document.getElementById('final-receiver').innerText = receiverName;
        };

        window.toggleAudio = function() {
            if(music.paused) {
                music.play();
                document.getElementById('music-toggle').innerText = "ðŸ”Š";
                isMusicPlaying = true;
            } else {
                music.pause();
                document.getElementById('music-toggle').innerText = "ðŸ”‡";
                isMusicPlaying = false;
            }
        };
    </script>
</body>
</html>